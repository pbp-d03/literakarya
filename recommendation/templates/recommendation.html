{% extends 'base.html' %}

{% block extra_css %}
<style>
  /* Warna latar belakang */
  body {
    background-color: #f4f4f4;
  }

  /* Gaya card */
  .card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  }

  .card-body {
    padding: 20px;
  }

  /* Gaya tombol */
  .btn {
    border-radius: 5px;
    transition: background-color 0.2s ease-in-out;
  }

  .btn-primary {
    background-color: #007bff;
    border: none;
  }

  .btn-primary:hover {
    background-color: #0056b3;
  }

  .btn-danger {
    background-color: #dc3545;
    border: none;
  }

  .btn-danger:hover {
    background-color: #c82333;
  }

  /* Gaya ikon */
  .icon {
    margin-right: 5px;
  }

  /* Gaya tombol aksi */
  .action-btn {
    display: flex;
    align-items: center;
  }

  .action-btn button {
    margin-right: 10px;
  }
</style>
{% endblock %}


{% block content %}
<h1 class="mt-4">Berbagi itu Indah</h1>

<div class="mb-4">
  <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
    <i class="bi bi-plus-circle icon"></i> Adakah Rekomendasi Buku {{ user }} ?
  </a>
</div>
<div class="collapse" id="collapseExample">
  <div class="card">
    <div class="card-body">
      Halo {{ user }}!<br>
      Apakah kamu punya rekomendasi buku yang ingin kamu bagikan?<br>
      <a href="{% url 'recommendation:bikin' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle icon"></i> Tambahkan Rekomendasi
      </a>
    </div>
  </div>
</div>

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">
      <i class="bi bi-book icon"></i> Rekomendasi Buku
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">
      <i class="bi bi-music-note icon"></i> Rekomendasi Playlist
    </button>
  </li>
</ul>
<div class="tab-content" id="pills-tabContent">
  <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
    <h2 class="my-4">
      REKOMENDASI BUKU UNTUKMU!
    </h2>
    <div class="row" id="recommendationRow">
      {% for recommend in recommended %}
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">{{ recommend.judul_buku }}</h5>
            <p class="card-text">Genre: {{ recommend.genre_buku }}</p>
            <p class="card-text">Rating: {{ recommend.nilai_buku }}</p>
            <p class="card-text">Rekomendasi: {{ recommend.isi_rekomendasi }}</p>
            <form action="{% url 'recommendation:like_view' recommend.id %}" method="POST">
              {% csrf_token %}
              <button type="submit" name="post_id" value="{{ post.id }}" class="btn btn-primary btn-sm">
                <i class="bi bi-hand-thumbs-up icon"></i>
                {% if user in recommend.likes.all %}
                  Unlike
                {% else %}
                  Like
                {% endif %}
              </button>  <span class="likes-count">{{ recommend.likes.count }}</span>
            </form>
            {% if user == recommend.user.username %}
            <a href="{% url 'recommendation:edit_rekom' recommend.id %}" class="btn btn-primary btn-sm">
              <i class="bi bi-pencil icon"></i> Edit
            </a>
            <a href="{% url 'recommendation:hapus_rekom' recommend.id %}" class="btn btn-danger btn-sm">
              <i class="bi bi-trash icon"></i> Hapus
            </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
    <h2 class="my-4">
      REKOMENDASI MUSIK UNTUKMU!
    </h2>
    <div>
      <iframe style="border-radius: 12px" src="https://open.spotify.com/embed/playlist/5IpDZcf75R6K7NvXYXJ2FV?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
    // Fungsi untuk mendapatkan CSRF Token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Mengatur CSRF Token untuk AJAX
    $.ajaxSetup({
        headers: { "X-CSRFToken": getCookie("csrftoken") }
    });

    document.addEventListener("DOMContentLoaded", function() {
    let genreSelect = document.querySelector("[name=genre_buku]");
    let bookSelect = document.querySelector("[name=judul_buku]");
    
    genreSelect.addEventListener("change", function() {
        let selectedGenre = genreSelect.value;

        fetch(`/get_books_by_genre/${selectedGenre}`)
        .then(response => response.json())
        .then(data => {
        // Hapus pilihan sebelumnya
        bookSelect.innerHTML = "";

        // Tambahkan pilihan baru berdasarkan genre
        for (let book of data) {
            let option = document.createElement("option");
            option.value = book.id;
            option.text = book.nama_buku;
            bookSelect.appendChild(option);
        }
        });
    });
    });
</script>

{% endblock content %}
