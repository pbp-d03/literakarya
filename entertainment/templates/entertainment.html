{% extends 'base.html' %}

{% load static %}

{% block content %}
<body>
  <div class="container">
    <!-- Bagian Collapse Bootstrap -->
    <div class="accordion" id="collapseAccordion">
        <div class="card">
            <div class="card-header" id="collapseHeader">
                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseContent" aria-expanded="true" aria-controls="collapseContent">
                    Adakah bacaan menarik?
                </button>
            </div>
            <div id="collapseContent" class="collapse" aria-labelledby="collapseHeader" data-parent="#collapseAccordion">
                <div class="card-body">
                    Bagaimana kabarmu, {{ user }}?
                    Ayo rekomendasikan buku!
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#recommendationModal">
                        Bacaan Menarik
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Carousel Bootstrap untuk menampilkan buku-buku hasil rekomendasi -->
    <div id="bookCarousel" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
            {% for recommendation in recommendations %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <h5>{{ recommendation.book_title.title }}</h5>
                <p>Rating: {{ recommendation.rating }}</p>
                <p>Rekomendasi: {{ recommendation.recommend }}</p>
                <!-- Tambahkan tombol Like di sini -->
                {% if user.id == recommendation.user.id %}
                    <a href="{% url 'entertainment:edit_recommendation' recommendation.id %}">Edit</a>
                    <a href="{% url 'entertainment:delete_recommendation' recommendation.id %}">Delete</a>
                {% else %}
                    <button class="like-button" data-id="{{ recommendation.id }}">Like</button>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        <a class="carousel-control-prev" href="#bookCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#bookCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>

    <!-- Playlist Buku dari Spotify -->
    <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/5IpDZcf75R6K7NvXYXJ2FV?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
  </div>

  <!-- Tambahkan file JavaScript yang diperlukan jika ada -->
  <script>
    $(document).ready(function() {
      $('.like-button').click(function() {
        let recommendationId = $(this).data('id');
        $.ajax({
          url: "{% url 'entertainment:like_recommendation' %}",
          method: 'POST',
          data: {
            'recommendation_id': recommendationId,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
          },
          success: function(response) {
            if (response.liked) {
              alert('Berhasil memberi like!');
            } else {
              alert('Anda sudah memberikan like sebelumnya.');
            }
          },
          error: function(response) {
            alert('Terjadi kesalahan, silakan coba lagi.');
          }
        });
      });
    });
  </script>
  
</body>

{% endblock %}
